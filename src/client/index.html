<!-- ./client/index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Bored Games</title>
    <style>
        #myCanvas {
            background-color: aquamarine;
        }
    </style>
</head>
<body>
<div>
    <canvas id="myCanvas" width="680" height="520"></canvas>
    <button onClick="sendMsg()">Hit Me</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.2.0/socket.io.js"></script>
<script>
      const socket = io("http://localhost:3000");
      socket.on("message", function(data) {
          console.log('received from server: ' + data);
      });

      function sendMsg() {
          socket.emit("message", "HELLO WORLD");
      }

      const canvas = document.getElementById('myCanvas');
      const ctx = canvas.getContext('2d');
      socket.emit('newPlayer');

      const drawPlayer = (player) => {
          ctx.beginPath();
          ctx.rect(player.x, player.y, player.width, player.height);
          ctx.fillStyle = '#0095DD';
          ctx.fill();
          ctx.closePath();
      };

      socket.on('state', (gameState) => {
          for (let player in gameState.players) {
              drawPlayer(gameState.players[player])
          }
      });

      const playerMovement = {
          up: false,
          down: false,
          left: false,
          right: false
      };
      const keyDownHandler = (e) => {
          if (e.keyCode === 39) {
              playerMovement.right = true;
          } else if (e.keyCode === 37) {
              playerMovement.left = true;
          } else if (e.keyCode === 38) {
              playerMovement.up = true;
          } else if (e.keyCode === 40) {
              playerMovement.down = true;
          }
      };
      const keyUpHandler = (e) => {
          if (e.keyCode === 39) {
              playerMovement.right = false;
          } else if (e.keyCode === 37) {
              playerMovement.left = false;
          } else if (e.keyCode === 38) {
              playerMovement.up = false;
          } else if (e.keyCode === 40) {
              playerMovement.down = false;
          }
      };

      setInterval(() => {
          socket.emit('playerMovement', playerMovement);
      }, 1000 / 60);
      document.addEventListener('keydown', keyDownHandler, false);
      document.addEventListener('keyup', keyUpHandler, false);
</script>
</body>
</html>